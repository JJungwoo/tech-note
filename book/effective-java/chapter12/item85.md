# 자바 직렬화의 대안을 찾으라

### 자바 직렬화의 위험성

- 직렬화는 근본적으로 지속적으로 계속 커지는 넓은 공격 범위 때문에 방어가 어렵다
  - 바이트 스트림을 역직렬화하는 과정에서 클래스 내부의 모든 코드를 수행할 수 있기에 클래스의 코드 전체가 공격 범위에 들어간다

- 자바의 표준 라이브러리나 아파치 커먼즈 컬렉션 같은 서드 파티 라이브러리는 물론 애플리케이션 자신의 클래스들도 공격 범위에 포함된다
  - 자바 라이브러리와 널리 쓰이는 서드 파티 라이브러리에서 직렬화 가능 타입들은 역직렬화 과정에 호출되어 잠재적으로 위험한 동작을 수행할 수 있는 메서드들이 있다

- 역직렬화 과정에 문제 상황 코드
  - 역직렬화 폭탄 <br>
  : 역직렬화 과정 시간이 오래 걸리는 짧은 스트림을 역직렬화하는 것만으로도 서비스 거부 공격에 쉽게 노출될 수 있다
  ```java
  static byte[] bomb() {
      Set<Object> root = new HashSet<>();
      Set<Object> s1 = root;
      Set<Object> s2 = new HashSet<>();

      for (int i=0; i < 100; i++) {
          Set<Object> t1 = new HashSet<>();
          Set<Object> t2 = new HashSet<>();

          t1.add("foo"); // t1을 t2과 다르게 만든다.
          s1.add(t1); s1.add(t2);
          s2.add(t1); s2.add(t2);

          s1 = t1; 
          s2 = t2;
      }
      return serialize(root);
  }
  ```

# 핵심 정리

